"use strict";let app=angular.module("surfstreams",["chart.js"]);app.config(function(e){e.resourceUrlWhitelist(["http://api.surfline.com/**","self"])}),app.controller("SurfController",["$scope","$http",function(e,a){e.sites=[{id:4762,name:"Banyans, Big Island, HI"},{id:10824,name:"Hapuna Bay, Big Island, HI"},{id:13830,name:"Kahalu'u, Big Island, HI"},{id:4763,name:"Kawaihae, Big Island, HI"},{id:10825,name:"Magics, Big Island, HI"},{id:10823,name:"Pine Trees, Big Island, HI"},{id:4750,name:"Pipeline, O'ahu, HI"},{id:4193,name:"Morro, Beach, SF"},{id:5065,name:"Pismo Beach, SF"},{id:4127,name:"Ocean Beach, SF"}]}]),app.controller("SiteController",["$scope","$http","$sce",function(e,a,t){console.debug("Instantiating SiteController");let s=!1;e.analysis,e.tide,e.tideData=[[]],e.tideLabels=[],e.surfData=[[],[]],e.surfSeries=["Surf Min","Surf Max"],e.surfLabels=[],e.$on("ss.fetch",function(){if(s)return void console.log("Already initialized");console.dir("Fetching forecast for site ID: "+e.site.id);let n="http://api.surfline.com/v1/forecasts/"+e.site.id+"?resources=wind,surf,analysis,weather,tide,sort,watertemp&days=3&getAllSpots=false&units=e&interpolate=false&showOptimal=false";a.jsonp(n).then(function(a){console.dir("Got forecast"),console.dir(a);let s=a.data;e.analysis=t.trustAsHtml(s.Analysis.short_term_forecast),e.tide=a.data.Tide,angular.forEach(a.data.Tide.dataPoints,function(a,t){let s=moment(a.Localtime).format("ddd, hA");e.tideLabels.push(s),e.tideData[0].push(a.height)}),angular.forEach(s.Surf.dateStamp,function(a,t){angular.forEach(a,function(a,n){let o=moment(a).format("ddd, hA");e.surfLabels.push(o),e.surfData[0].push(s.Surf.surf_min[t][n]),e.surfData[1].push(s.Surf.surf_max[t][n])})})},function(e){console.dir("Error obtaining forecast"),console.dir(e)}),s=!0})}]),app.directive("ssPanel",["$http",function(e){return{restrict:"E",replace:!0,templateUrl:"templates/panel.html",link:function(a,t,s){let n,o="#player-"+a.site.id;t.on("hidden.bs.collapse",function(e){console.log("Removing player "+o),n&&n.destroy()}),t.on("shown.bs.collapse",function(t){t.stopPropagation(),console.dir("show.bs.collapse");let s="http://api.surfline.com/v1/cams/"+a.site.id;console.log(s),e.jsonp(s).then(function(e){console.log("Got response from Cam ID: ",a.site.id),console.dir(e);let t=e.data.streamInfo.stream[0].file;console.log("Player "+o+" playing stream: "+t),n=new Clappr.Player({parentId:o,source:t,autoPlay:!0,width:"100%",height:"100%"})},function(e){console.dir("Error reading Surfline API"),console.dir(e)}),a.$broadcast("ss.fetch")})}}}]);